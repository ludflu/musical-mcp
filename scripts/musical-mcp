#!/bin/bash

# Musical MCP Docker Runner
# This script runs the musical-mcp program in Docker with MIDI device support

set -e

# Docker image name
IMAGE_NAME="musical-mcp:latest"

# Check if Docker is running
if ! docker info > /dev/null 2>&1; then
    echo "Error: Docker is not running. Please start Docker first."
    exit 1
fi

# Check if the Docker image exists
if ! docker image inspect "$IMAGE_NAME" > /dev/null 2>&1; then
    echo "Error: Docker image '$IMAGE_NAME' not found."
    echo "Please build the image first with: make docker-build"
    exit 1
fi


# Determine if we need TTY allocation
TTY_OPTS=""
if [ -t 0 ]; then
    TTY_OPTS="-it"
else
    TTY_OPTS="-i"
fi

# Run the Docker container with all provided arguments
echo "Running musical-mcp in Docker with MIDI support..."
exec docker run --rm $TTY_OPTS $DOCKER_OPTS -v /tmp:/tmp "$IMAGE_NAME" uv run src/main.py "$@"
